<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="icon" type="image/x-icon" href="../images/favicon.png">
    <title>WheatherMan</title>
  </head>
  <body>
    <div id="app">
        <h1>WheatherMan</h1>
        <p>Find out whether you should bring that umbrella (or that mask)...</p>
        <input v-model="city" placeholder="City">
        <br><br>
        <button v-on:click="GetForecast">Submit</button>
        <br><br>
        <!-- Only display response if there is one -->
        <div id="data" v-if="Object.entries(response).length !== 0">
          <!-- Display error message if error returned from server -->
          <span id="error" v-if="response.hasOwnProperty('error')"> 
            Oops!
            <br>
            WheatherMan couldn't find that one...
            <br>
            Here's a joke instead :)
            <!-- Get and display joke here -->
          </span>
          <!-- Display data returned from server -->
          <div id="info" v-else="!response.hasOwnProperty('error')"> 
            <span id="city">{{ city }}</span>
            <p v-if="bringUmbrella">Might want to take the umbrella...</p>
            <p v-else="!bringUmbrella">You won't need that umbrella...</p>
            <p v-if="bringMask">and you will need that mask</p>
            <p v-else="!bringMask">and you won't need that mask :)</p>
            <table>
              <tr>
                <th v-for="forecast in response.weather">{{forecast.day}}</th>
              </tr>
              <tr>
                <td v-for="forecast in response.weather">{{forecast.temperature}}°C</td>
              </tr>
              <tr>
                <td v-for="forecast in response.weather">{{forecast.windSpeed}}m/s</td>
              </tr>
              <tr>
                <template v-for="forecast in response.weather">
                  <td v-if="forecast.rainfallLevel!==null">{{forecast.rainfallLevel}}mm</td>
                  <td v-else="forecast.rainfallLevel===null">N/A</td>
                </template>
              </tr>
            </table>
            <table>
              <tr>
                <th v-for="forecast in response.airPollution">{{forecast.day}}</th>
              </tr>
              <tr>
                <td v-for="forecast in response.airPollution">{{forecast.pm2_5}}μg/m3</td>
              </tr>
            </table>
          </div>
        </div>
    </div>
  </body>
  <script type = "text/JavaScript">
    var app = new Vue({
    el:"#app",
    data:{
        city: "",
        bringUmbrella: false,
        bringMask: false,
        typeOfWeather: "",
        response: {},
    },
    methods:{
        GetForecast : getForecast 
    }
    })

    function getForecast (){
        let prom = fetch("http://localhost:5500/weather/" + this.city)
        prom.then( response => response.json())
        .then (response =>
        { this.response = response
        })
    }

  </script>
</html>
